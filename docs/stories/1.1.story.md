# Story 1.1: Project Setup and Core Infrastructure

**Status:** Ready  
**Epic:** 1 - Foundation & Real-time Infrastructure  
**Story Points:** 8  
**Priority:** Critical  

## Story

As a developer,  
I want a properly configured full-stack project with CI/CD pipeline,  
so that the team can develop and deploy features reliably from day one.

## Acceptance Criteria

1. Monorepo structure created with frontend (React/TypeScript) and backend (Node.js/Express) applications
2. PostgreSQL database configured with Prisma ORM and initial schema
3. Redis instance configured for session caching
4. Environment configuration for local development, staging, and production
5. Basic CI/CD pipeline configured for automated testing and deployment
6. Health check endpoints implemented and accessible
7. HTTPS and security headers configured for production deployment

## Dev Notes

### Technical Stack Requirements
[Source: architecture.md#Tech Stack]

**Core Technologies:**
- **Language:** TypeScript 5.3.3 - Primary development language
- **Runtime:** Node.js 20.11.0 LTS - JavaScript runtime
- **Framework:** Express.js 4.18.2 - Backend API framework
- **Database:** PostgreSQL 15.4 - Primary data store
- **ORM:** Prisma 5.7.1 - Database abstraction
- **Caching:** Redis 7.2 - Session state and caching

### Project Structure
[Source: architecture.md#Source Tree]

```
bmad-platform/
├── packages/
│   ├── api/                     # Backend orchestration services
│   │   ├── src/
│   │   │   ├── services/        # Core business logic services
│   │   │   ├── controllers/     # HTTP request handlers
│   │   │   ├── middleware/      # Authentication, validation, logging
│   │   │   ├── models/          # Prisma schema and database models  
│   │   │   └── utils/           # Shared utilities and helpers
│   │   ├── prisma/              # Database schema and migrations
│   │   └── package.json
│   ├── realtime/               # WebSocket service
│   │   ├── src/
│   │   │   ├── handlers/        # Socket event handlers
│   │   │   └── middleware/      # Socket authentication
│   │   └── package.json
│   ├── shared/                 # Shared TypeScript types and utilities
│   │   ├── src/types/          # Common type definitions
│   │   └── package.json
│   └── infrastructure/         # Infrastructure as Code
│       ├── terraform/          # Cloud resource definitions
│       └── docker/             # Container configurations
├── scripts/                    # Monorepo management and deployment
└── package.json              # Root workspace configuration
```

### Database Schema Requirements
[Source: architecture.md#Data Models]

**Initial Schema Entities:**
- **User:** Authentication and subscription management
- **PlanningSession:** Core planning workflow execution
- **ConversationMessage:** Individual messages in planning conversation
- **AgentExecution:** Agent workflow execution tracking
- **Document:** Generated planning documents
- **LLMRequest:** LLM API call tracking

### Infrastructure Requirements
[Source: architecture.md#Infrastructure and Deployment]

**Cloud Infrastructure:**
- **Primary Hosting:** Railway for backend services
- **Database:** PostgreSQL managed service
- **Caching:** Redis Cloud for session management
- **CI/CD:** GitHub Actions pipeline

### Testing Infrastructure
[Source: architecture.md#Tech Stack]

- **Testing Framework:** Jest 29.7.0 + Supertest 6.3.3
- **Testing Approach:** Unit and integration testing
- **Coverage Goals:** From testing strategy (to be defined)

### Security Configuration
[Source: architecture.md#Security]

- **Authentication:** JWT + Passport.js 0.7.0/0.6.0
- **Validation:** Zod 3.22.4 for runtime type validation
- **Security Headers:** Helmet.js for production security
- **HTTPS:** Automatic redirect in production

### Monitoring Setup
[Source: architecture.md#Tech Stack]

- **Logging:** Winston 3.11.0 for structured logging
- **Error Tracking:** Sentry 7.81.1 for error monitoring
- **Process Management:** PM2 5.3.0 for production deployment

## Tasks / Subtasks

### Task 1: Monorepo Setup (AC: 1)
1.1. Initialize root package.json with workspace configuration
1.2. Create packages/ directory structure per project layout
1.3. Setup TypeScript configuration for monorepo
1.4. Configure shared package with common types
1.5. Setup ESLint and Prettier for code consistency

### Task 2: Backend API Package Setup (AC: 1)
2.1. Initialize packages/api with Express.js and TypeScript
2.2. Setup Express server with basic routing
2.3. Configure middleware stack (cors, helmet, logging)
2.4. Setup environment configuration management
2.5. Implement health check endpoint (/api/health)

### Task 3: Database Configuration (AC: 2)
3.1. Setup Prisma in packages/api/prisma/
3.2. Configure PostgreSQL connection string management
3.3. Create initial schema with User and basic models
3.4. Setup migration system and initial migration
3.5. Test database connection and schema creation

### Task 4: Redis Configuration (AC: 3)
4.1. Install and configure Redis client
4.2. Setup Redis connection with environment variables
4.3. Create session store configuration
4.4. Test Redis connection and basic operations
4.5. Setup Redis health check

### Task 5: Environment Configuration (AC: 4)
5.1. Create .env templates for all environments
5.2. Setup environment validation with Zod
5.3. Configure development environment variables
5.4. Setup staging environment configuration
5.5. Configure production environment variables
5.6. Document environment setup process

### Task 6: CI/CD Pipeline (AC: 5)
6.1. Create GitHub Actions workflow file
6.2. Setup Node.js and dependencies installation
6.3. Configure testing pipeline with Jest
6.4. Setup build process for TypeScript compilation
6.5. Configure deployment to Railway
6.6. Setup environment-specific deployments

### Task 7: Security Configuration (AC: 7)
7.1. Configure Helmet.js security headers
7.2. Setup HTTPS redirect middleware
7.3. Configure CORS for allowed origins
7.4. Setup rate limiting middleware
7.5. Configure security environment variables

### Task 8: Testing Setup (AC: 1, 5, 6, 7)
8.1. Configure Jest for API testing
8.2. Setup Supertest for endpoint testing
8.3. Create test for health check endpoint
8.4. Test database connection functionality
8.5. Test Redis connection functionality
8.6. Create integration test for basic API flow
8.7. Setup test coverage reporting

### Task 9: Documentation (AC: 1-7)
9.1. Create README.md with setup instructions
9.2. Document environment configuration process
9.3. Create development workflow documentation
9.4. Document database setup and migration process
9.5. Create troubleshooting guide for common issues

## Testing

### Unit Tests Required
- Database connection configuration
- Redis connection configuration  
- Environment variable validation
- Health check endpoint functionality
- Security middleware configuration

### Integration Tests Required
- End-to-end API health check
- Database connection and basic operations
- Redis session store functionality
- Complete development environment setup

## Project Structure Notes

All file paths and naming conventions align with the monorepo structure defined in architecture.md. The packages/ organization supports the microservices approach while maintaining shared types and utilities.

## Definition of Done

- [ ] Monorepo structure matches architecture specification
- [ ] All services start successfully in development environment
- [ ] Database connection established and schema created
- [ ] Redis connection established and session store configured
- [ ] Environment configuration works for dev/staging/prod
- [ ] CI/CD pipeline successfully deploys to staging
- [ ] Health check endpoints return 200 OK
- [ ] HTTPS and security headers configured for production
- [ ] All unit tests pass with >90% coverage
- [ ] Integration tests verify full stack functionality
- [ ] Documentation allows new developer to setup project
- [ ] Code follows established linting and formatting standards

## Dev Agent Record

*This section will be populated during development*

## QA Results

### Review Date: 2025-09-08

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

This foundational infrastructure story demonstrates excellent architectural planning and comprehensive technical coverage. The story properly establishes the critical backbone for the entire BMAD platform with well-defined separation of concerns, security-first approach, and scalable monorepo structure. All acceptance criteria are clearly traceable to implementation tasks with appropriate technical depth.

### Refactoring Performed

No refactoring performed - this is a specification-only story requiring implementation.

### Compliance Check

- Coding Standards: ✓ Aligns with TypeScript/Node.js standards
- Project Structure: ✓ Perfect match with architecture.md specifications  
- Testing Strategy: ✓ Comprehensive unit and integration test coverage
- All ACs Met: ✓ All 7 acceptance criteria properly addressed

### Improvements Checklist

[All items for developer implementation]

- [ ] Consider adding infrastructure monitoring beyond basic logging
- [ ] Add load testing framework for infrastructure limits
- [ ] Include failover testing for critical dependencies
- [ ] Consider infrastructure-as-code for Redis/PostgreSQL provisioning
- [ ] Add security penetration testing framework setup
- [ ] Include performance benchmarking for baseline metrics

### Security Review

Excellent security foundation with JWT authentication, Helmet.js security headers, HTTPS enforcement, CORS configuration, and rate limiting. All security requirements properly addressed for production deployment.

### Performance Considerations

Strong performance foundation with Redis caching layer, PostgreSQL with Prisma ORM optimization, and proper monitoring setup. Infrastructure supports scaling requirements from Epic 5.

### Files Modified During Review

None - specification review only.

### Gate Status

Gate: PASS → docs/qa/gates/1.1-project-setup-and-core-infrastructure.yml
Risk profile: Low-risk foundational story with comprehensive planning
NFR assessment: All NFRs properly addressed with appropriate technical stack

### Recommended Status

✓ Ready for Development - Comprehensive planning with clear implementation path
(Story owner decides final status)

## Change Log

| Date | Author | Change Description |
|------|--------|-------------------|
| 2025-09-08 | Sarah (PO) | Initial story creation from Epic 1 requirements |